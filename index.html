<meta name="description" content="–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –∞—É–¥–∏–æ-—Ä—É–ª–µ—Ç–∫–∞ –¥–ª—è –æ–±—â–µ–Ω–∏—è. –ó–∞—Ö–æ–¥–∏ –∏ –æ–±—â–∞–π—Å—è –≥–æ–ª–æ—Å–æ–º –≤ –≥—Ä—É–ø–ø–∞—Ö –¥–æ 4 —á–µ–ª–æ–≤–µ–∫!">
<meta name="keywords" content="–∞—É–¥–∏–æ —Ä—É–ª–µ—Ç–∫–∞, –≥–æ–ª–æ—Å–æ–≤–æ–π —á–∞—Ç, –æ–±—â–µ–Ω–∏–µ, –∞–Ω–æ–Ω–∏–º–Ω—ã–π —á–∞—Ç">
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Radio-Roulette v0.4.1</title>
    <style>
        body { 
            background: #0b0b0b; color: #eee; font-family: sans-serif;
            display: flex; flex-direction: column; align-items: center; margin: 0; padding: 20px;
        }

        /* –¢–ê –°–ê–ú–ê–Ø –ö–ù–û–ü–ö–ê (–®–ï–°–¢–ï–†–ù–Ø) */
        #gear-btn {
            position: fixed; top: 15px; right: 15px;
            width: 55px; height: 55px; background: #222;
            border: 2px solid #ff4500; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 30px; cursor: pointer; z-index: 1000;
        }

        /* –ú–û–î–ê–õ–ö–ê (–û–ö–ù–û –ù–ê–°–¢–†–û–ï–ö) */
        #modal-bg {
            display: none; position: fixed; top: 0; left: 0; 
            width: 100%; height: 100%; background: rgba(0,0,0,0.95);
            z-index: 2000; justify-content: center; align-items: center;
        }
        .modal-content {
            background: #151515; padding: 25px; border: 2px solid #ff4500;
            border-radius: 15px; width: 300px; text-align: center;
        }

        /* –°–ï–¢–ö–ê –°–õ–û–¢–û–í */
        .grid {
            display: grid; grid-template-columns: 1fr 1fr; grid-gap: 15px;
            width: 100%; max-width: 500px; margin-top: 80px;
        }
        .card {
            background: #1a1a1a; border: 2px solid #333; height: 140px;
            border-radius: 12px; display: flex; flex-direction: column;
            align-items: center; justify-content: center; font-weight: bold;
        }
        .active { border-color: #ff4500; }

        /* –í–ù–£–¢–†–ï–ù–ù–û–°–¢–ò –ú–û–î–ê–õ–ö–ò */
        .setting-item { margin-bottom: 20px; text-align: left; }
        label { font-size: 13px; color: #ff4500; font-weight: bold; display: block; margin-bottom: 5px; }
        select { 
            width: 100%; padding: 10px; background: #222; color: white; 
            border: 1px solid #444; border-radius: 5px;
        }

        .mic-test-box {
            background: #222; padding: 15px; border-radius: 10px; margin-top: 10px;
        }
        #mic-icon { font-size: 40px; transition: 0.1s; display: inline-block; }

        .btn-ui { 
            width: 100%; padding: 12px; border: none; border-radius: 8px; 
            cursor: pointer; font-weight: bold; transition: 0.2s;
        }
        .btn-save { background: #ff4500; color: white; margin-top: 15px; }
        .btn-test { background: #444; color: white; margin-top: 10px; }

        /* –ö–ù–û–ü–ö–ò –ì–õ–ê–í–ù–û–ì–û –≠–ö–†–ê–ù–ê */
        .main-controls { margin-top: 30px; }
        .btn-search { padding: 15px 40px; border-radius: 30px; border: none; cursor: pointer; font-weight: bold; font-size: 18px; background: #ff4500; color: white; }
        .btn-stop { padding: 15px 40px; border-radius: 30px; border: none; cursor: pointer; font-weight: bold; font-size: 18px; background: #900; color: white; display: none; }
    </style>
</head>
<body>

    <div id="gear-btn" onclick="openSettings()">‚öôÔ∏è</div>

    <h1>RADIO-ROULETTE</h1>
    <p>–†–µ–∂–∏–º: <span id="label-count">4</span> —á–µ–ª.</p>

    <div class="grid" id="grid"></div>

    <div class="main-controls">
        <button id="start-btn" class="btn-search" onclick="startSearch()">–ù–ê–ô–¢–ò –õ–Æ–î–ï–ô</button>
        <button id="stop-btn" class="btn-stop" onclick="stopSearch()">–ü–†–ï–ö–†–ê–¢–ò–¢–¨</button>
    </div>

    <div id="modal-bg">
        <div class="modal-content">
            <h2 style="margin: 0 0 20px 0; color: #ff4500;">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
            
            <div class="setting-item">
                <label>–õ–Æ–î–ï–ô –í –ö–û–ú–ù–ê–¢–ï:</label>
                <select id="sel-count" onchange="updateCount()">
                    <option value="2">2 —á–µ–ª–æ–≤–µ–∫–∞</option>
                    <option value="3">3 —á–µ–ª–æ–≤–µ–∫–∞</option>
                    <option value="4" selected>4 —á–µ–ª–æ–≤–µ–∫–∞</option>
                </select>
            </div>

            <div class="setting-item">
                <label>–í–´–ë–û–† –ú–ò–ö–†–û–§–û–ù–ê:</label>
                <select id="mic-select">
                    <option>–°–Ω–∞—á–∞–ª–∞ –Ω–∞–∂–º–∏ —Ç–µ—Å—Ç...</option>
                </select>
                <div class="mic-test-box">
                    <div id="mic-icon">üé§</div><br>
                    <button class="btn-ui btn-test" onclick="initMic()">–ü–†–û–í–ï–†–ò–¢–¨ –ú–ò–ö–†–û</button>
                </div>
            </div>

            <button class="btn-ui btn-save" onclick="closeSettings()">–°–û–•–†–ê–ù–ò–¢–¨</button>
        </div>
    </div>

    <script>
        let count = 4;
        let timers = [];
        let stream = null;

        // –û—Ç–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª–∫—É
        function openSettings() {
            document.getElementById('modal-bg').style.display = 'flex';
        }

        // –ó–∞–∫—Ä—ã—Ç—å –∏ –≤—ã–∫–ª—é—á–∏—Ç—å –º–∏–∫—Ä–æ
        function closeSettings() {
            if (stream) stream.getTracks().forEach(track => track.stop());
            document.getElementById('modal-bg').style.display = 'none';
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞
        async function initMic() {
            try {
                // –ó–∞–ø—Ä–æ—Å –¥–æ—Å—Ç—É–ø–∞
                stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤
                const devices = await navigator.mediaDevices.enumerateDevices();
                const mics = devices.filter(d => d.kind === 'audioinput');
                const select = document.getElementById('mic-select');
                select.innerHTML = '';
                
                mics.forEach(m => {
                    const opt = document.createElement('option');
                    opt.value = m.deviceId;
                    opt.text = m.label || `–ú–∏–∫—Ä–æ—Ñ–æ–Ω ${select.length + 1}`;
                    select.appendChild(opt);
                });

                // –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∑–≤—É–∫–∞
                const ctx = new AudioContext();
                const src = ctx.createMediaStreamSource(stream);
                const ans = ctx.createAnalyser();
                src.connect(ans);
                const data = new Uint8Array(ans.frequencyBinCount);
                const icon = document.getElementById('mic-icon');

                function loop() {
                    if (!stream.active) return;
                    ans.getByteFrequencyData(data);
                    let vol = data.reduce((a, b) => a + b) / data.length;
                    icon.style.transform = `scale(${1 + vol / 30})`;
                    requestAnimationFrame(loop);
                }
                loop();
            } catch (e) {
                alert("–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É!");
            }
        }

        // –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω
        function updateCount() {
            count = parseInt(document.getElementById('sel-count').value);
            document.getElementById('label-count').innerText = count;
            stopSearch();
        }

        function draw() {
            const g = document.getElementById('grid');
            g.innerHTML = '<div class="card active">üë§<br>–¢–´</div>';
            for(let i=1; i<count; i++) {
                g.innerHTML += `<div class="card" id="slot-${i}" style="opacity:0.3; border-style:dashed;">?</div>`;
            }
        }

        function startSearch() {
            document.getElementById('start-btn').disabled = true;
            document.getElementById('start-btn').innerText = "–ü–û–ò–°–ö...";
            for(let i=1; i<count; i++) {
                let t = setTimeout(() => {
                    const s = document.getElementById(`slot-${i}`);
                    if(s) {
                        s.style.opacity = "1"; s.style.borderStyle = "solid"; s.classList.add('active');
                        s.innerHTML = `üîä<br>User_${Math.floor(Math.random()*999)}`;
                    }
                    if(i === count - 1) {
                        document.getElementById('start-btn').style.display = "none";
                        document.getElementById('stop-btn').style.display = "block";
                    }
                }, i * 1200);
                timers.push(t);
            }
        }

        function stopSearch() {
            timers.forEach(clearTimeout); timers = [];
            document.getElementById('start-btn').style.display = "block";
            document.getElementById('start-btn').disabled = false;
            document.getElementById('start-btn').innerText = "–ù–ê–ô–¢–ò –õ–Æ–î–ï–ô";
            document.getElementById('stop-btn').style.display = "none";
            draw();
        }

        draw();
    </script>
</body>
</html>
